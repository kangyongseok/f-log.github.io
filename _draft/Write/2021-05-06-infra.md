---
title: "그림으로 공부하는 IT 인프라 구조"
categories: 
  -  write
tags: 
    - 인프라
    - 책 내용 정리
toc: true
toc_sticky: true
comments:  true
---

프론트직무를 하면서 인프라와 상관없을수도있지만 인프라를 담당하거나 그럴일이 있을까 싶지만 그냥 관심이 가서 읽어보니 생각보다 아주 관련이 없진않아서 내용을 정리하려고 한다. 인프라가 프론트와 관련이 있다기보다는 인프라에 대한 내용을 설명하는 내용을 보다보니 그 개념이나 동작원리가 프론트를 다루는데 있어서 필요한 지식들이 일부 겹쳐지거나 포함되는 부분이 있는것같다.

적어도 평생 IT 개발자를 할거라면 비전공이더라도 변하지않는 근본적인 내용과 동작방식에 대해서 이해하고 알고있어야 뒤쳐지지않고 지속적인 학습을하며 발전해 나갈 수 있을것같다.

## 인프라
> 기반시설, 기간시설 경제활동의 기반을 형성하는 기초적인 시설과 시스템을 말하며 도로나 하천, 항만, 공항 등과같이 경제활동에 밀접한 사회자본을 말한다. - 위키백과

위키에서는 경제활동에 대한 기반시설이라고 설명하고있는데 IT 에서의 인프라는 웹을 기준으로 든다면 서버가 동작하기 위한 기반시설, OS 가 동작하기위한 기반, 웹이 동작하기 위한 기반을 인프라라고 볼 수 있겠다. 
  
IT 에서의 인프라는 당연히 컴퓨터로 구성된다. 흔히 사용하는 입력과 출력이 갖춰진 즉 모니터 키보드 마우스가 갖춰진 컴퓨터가 있는가하면 그냥 큰 덩어리로 존재하는 서버컴퓨터들을 말한다. 이 컴퓨터들이 어떻게 구성되어있고 어떤 관계를 맺어서 또 그 양에 따라서 집약형과 분할형으로 나눌 수 있다.

### 집약형
대형컴퓨터 한대로 다양한 모든 처리를 할 수 있다. 은행업무를 예로들자면 입금, 출금, 이체, 계좌개설 등 다양한 업무가 있을 수 있는데 이 모든걸 하나의 컴퓨터로 처리하는것이 집약형이다. 한대의 컴퓨터로 처리하기때문에 장비고장으로 업무가 멈추기 않기위한 고민이 필요하고 이를위해 내부 부품은 이중화시켜 사용하게된다.
- 한대만 있으면 되므로 구성이 간단
- 그러나 확장성에 한계가있고 초기 도입 비용이 비싸다

### 분할형
분할형은 위에서말한 각각의 은행업무를 각각의 컴퓨터가 분할해서 처리하는 방식이다.
- 낮은비용으로 구축이 가능하고 확장성이 높다
- 컴퓨터가 늘어나고 확장할수록 관리구조가 복잡해진다.

### 물리서버와 논리서버
컴퓨터 자체를 물리서버 웹서버같은걸 논리서버라고 부른다.


각 상황과 목적에 맞게 여러가지 형태를 조합해서 인프라를 구성하게된다. 수평분할 아키텍쳐로 구성하다가 각 아키텍쳐의 데이터 공유가 필요하다면 공유형아키텍쳐로 구성해야하고 공유형 아키텍쳐에서 보안상의 문제가 심각한 화두가 된다면 다시 수평분할형태로 가는것이 맞을것이다.

## 하드웨어
서버와 PC 의 내부 구성품은 거의비슷하다 단지 갯수와 확장성 그리고 장애 대응에 서버가 좀더 강하게 구성하는것정도의 차이는 있을지라도 기본적인 구성과 동작방식은 동일하다. 

CPU 는 명령을 받아서 연산을 실행하고 결과를 반환한다. 이때 명령을 내리는건 OS 소프트웨어이고 이 명령을 내리기위해 필요한것이 마우스나 키보드를 사용한 입력이다.

메모리는 CPU 옆에 위치하며 서버를 재시작하게되면 사라지는 휘발성 정보를 담는 영역이다. 이렇게 사라지는 정보를 담는 메모리르 사용하는 이유는 엑세스가 빠르기때문이다. CPU 자체도 메모리를 갖고있지만 본래의 메모리보다는 용량이 매우 작아 캐시를하는 용도정도로 사용된다.

HDD 하드디스크는 가장 느리지만 가장 많은 저장용량을 갖고있고 또 휘발성이 아니라 장기데이터 저장소로 사용된다. 때문에 CPU 와는 가장 멀리 떨어져있다.

## OS 의 필수개념 프로세스와 스레드 커널

### 프로세스와 스레드
프로세스와 스레드는 비교대상으로 질문되어지는것같은데 기본적으로 둘다 활동하려면 메모리공간이 필요하다. 이 메모리공간은 커널에 의해서 확보되는데 이 공간에서 다양한 데이터를 주고받으며 처리하게된다.

하나의 프로세스안에는 여러개의 스레드가 존재할 수 있으며 스레드들은 메모리공간으 공유할 수 있다. 때문에 다른 스레드에 이상이 발생하면 영향을 받게된다. 프로세스는 전용 메모리공간을 갖고 활동하는데 이때문에 CPU부하가 스레드에 비해 높아지게된다.

### 커널 
OS 에서 커널은 심장이자 뇌이며 척수이고 커널이 OS 의 본질이나 마찬가지이다. 커널의 역할은 여섯가지로 정리할 수 있다.
1. 시스템 콜 인터페이스
2. 프로세스 관리
3. 메모리관리
4. 네트워크 스택
5. 파일 시스템 관리
6. 장치 드라이버

## 웹 데이터 흐름
- 웹 브라우저가 요청을 발행한다.
- 이름을 해석한다.
- 웹 서버가 요청을 접수한다.
- 웹 서버가 정적 또는 동적 콘텐츠인지 판단한다.
- 필요한 경로로 데이터에 엑세스한다.

- 웹 서버로부터 요청이 도착한다.
- 스레드가 요청을 받으면 자신이 처리할지 DB 접속이 필요할지 판단
- DB 접속이 필요하면 연결풀에 엑세스

- AP 서버로부터 요청이 도착
- 프로세스가 요청을 접수하고 캐시가 존재하는지 확인
- 캐시에 없으면 디스크에 엑세스
- 디스크가 데이터를 반환
- 데이터를 캐시형태로 저장
- 결과를 AP 서버에 반환

## 가상화
OS 도 가상화 기술중의 하나이다. 하드웨어의 제품이나 종류는 다양하지만 어떤 하드웨어로 구성되어있더라도 OS는 잘 돌아간다. 만약 OS 가 없다면 하드웨어의 사양을 고려해서 프로그래밍을 작성해야 했을것이다. 

### 가상 머신의 종류
- 호스트 OS형
- 하이퍼바이저형

첫번쨰 호스트형은 윈도우즈나 리눅스 등 호스트 OS 상에 가상화 소프트웨어를 설치하는것이고 하이퍼바이저형은 하드웨어상에서 직접 가상화 소프트웨어를 실행하고 그 위에 가상머신을 동작시키는 기술이다.

### 도커의 등장
도커파일에서 도커이미지를 작성하면 이 이미지에는 
- 애플리케이션 프레임워크
- 애플리케이션 라이브러리
- OS 이미지

가 모두 포함된 상태로 이미지가 생성되고 도커허브를 통해 이러한 이미지들을 공유할 수 있게되었다. 
  
도커를 사용함에 있어서 장점은
- 컨테이너는 호스트 OS와 OS 커널을 공유하므로 컨테이너 실행이나 정지 속도가 빠르다.
- 한대의 호스트머신상에서 훨씬 많은 컨테이너를 실행할 수 있다.
- 도커이미지로 라이브러리 프레임워크등을 묶어 공유할 수 있어 서로 다른 개발환경에서도 동일한 동작을 보장할 수 있어 버그를 효율적으로 수정하는것이 가능하다.

## 직렬 / 병렬
직렬과 병렬에는 서로 장단점이있고 직렬과 병렬이 복합적으로 사용될때 여러가지 고려해야할 부분이 있다. 병렬화 할수 있는것과 없는것이 있는데 만약 병렬과 직렬이 이어졌을때 해당 구간은 병목지점이 된다. 직렬에 병렬처리가 몰려서 오버헤드가 발생하거나 직렬에서 병렬로 내보낼때 하나의 처리만 내보낼 수 있거나 하는 구간이 발생하게된다.
- 직렬로 처리속도를 올리는데에는 한계가있다.
- 병렬화를 통해 속도는 빨라지지않지만 단위시간당 처리량을 늘릴 수 있다.

### 예시 - 웹 서버와 AP 서버에서의 병렬화
- 웹 서버에는 다수의 이용자가 접속하기때문에 복수의 프로세스가 분담해서 병렬처리를 한다.
- AP 서버에서는 JVM 프로세스가 하나이지만 복수의 스레드가 병렬로 처리

병렬로 처리할때 서버의 갯수도 중요하지만 이를 처리할 수 있는 CPU의 코어수도 고려해야한다. 편의점으로 치면 계산대는 한개인데 계산하는 종업원은 여러명이될 수도있다.

### 병렬화시 주의할점
- 병렬화를 한다고 직렬처리 성능이 향상되는것은 아니지만 단위 시간단 처리량을 늘릴 수 있다.
- 병렬처리는 합류점, 직렬화 구간, 분기점이 병목지점이 될 수 있다.
- 병렬화를 도입했을때 오버헤드나 복잡도에 대한 단점을 고려하여 충분히 이점이 더 크다라고 판단되었을때 병렬화를 진행한다.


## 큐 Queue
큐는 자료구조종류중 하나로 선입선출의 동작원리를 갖고있다. 사람들이 줄을 서있을때 가장 먼저온사람이 가장 먼저 입장하거나 가장 먼저 계산을 하는것을 말한다. 컴퓨터내에서도 다양한 행렬이 만들어지는데 아래와같은경우 큐를 사용한다.
- CPU 처리를 기다리고있는 프로세스나 스레드 행렬
- 하드 디스크 등의 저장소 읽기처리를 기다리고있는 I/O 행렬
- 네트워크 접속 성립을 기다리고 있는 접속 요구 행렬
 
### 런큐
CPU 를 기다리고있는 프로세스행렬을 말하며 런큐에 쌓인 프로세스 수를 코어수로 나누어 1이라면 문제가 없다라는것이 일반적이다. OS 커널에는 프로세스 스케줄러라는 기능이 있어서 런큐등을 관리한다.

### 배타적 제어
회사엑서 회의실이 사용중이라면 다른사람들이 사용할 수가 없는것과 같다. 병렬처리시 주로 배타적 제어를 사용하며 배타적 제어를 사용하는 이유는 데이터나 자원을 공동으로 사용하기때문에 이러한 처리가 필요하다.

- 복수의 처리가 공유자원에 동시에 엑세스하면 불일치가 발생할 수 있다.
- 배타적제어에서는 특정처리가 공유자원을 이용하고 있다면 다른처리가 이용할 수 없도록하여 자원의 불일치를 방지한다.
  
다만 배타적제어를 적용할 경우 한번에 여러개의 처리가 불가능하기때문에 병렬처리가 안된다.

