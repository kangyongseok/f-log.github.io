---
title: "JavaScript 실행컨텍스트"
categories: 
  - javascript
tags: 
    - 자바스크립트
    - 자바스크립트기본
    - 기본으로돌아가서
    - 실행컨텍스트
toc: true
toc_sticky: true
comments:  true
---


실행컨텍스트를 이해하면 호이스팅, This, 클로저, 스코프, 렉시켤 환경에 대한 개념들과 이해를 할 수있고 왜 alert 이나 var 키워드로 선언한 전역 변수는 window 식별자 없이 바로 사용할 수 있는지에 대한 의문도 풀릴 수 있다. 

## 실행컨텍스트
코드가 실행되는 영역이며 소스코드의 평가와 실행 또는 소스코드의 생성과 실행 이라는 두 단계로 나누어 동작한다. 소스코드평가 또는 생성단계에서 선언문(변수, 함수)이 먼저 스코프(렉시컬 환경의 환경레코드) 에 등록된다.
```js
var a = 1;
function myFunc() {}
myFunc()

전역실행컨텍스트: {
  렉시컬환경 : {
    환경레코드 : {
      a: undefined,
      myFunc: function
    }
  }
}
```
이 과정이 끝나고 나면 함수 실행과정이 진행된다 이때 변수에 값이 할당되고 함수가 호출된다. 함수가 호출되고나면 전역코드 실행이 중단되고 함수실행컨텍스트로 컨트롤이 이동한다. 함수코드평가 과정이 발생하는데 이때 전역에서와 동일하게 함수를 실행하기위한 환경을 준비한다. 함수를 통해 넘어온 매개변수와 함수 내부에 지역변수로 선언된 선언문이 먼저 실행되고 평가된 선언문은 함수내부에 생성된 실행컨텍스트의 스코프에 등록된다.
  
이때 argument객체와 this 바인딩이 결정된다.
> 실행컨텍스트는 식별자를 관리하는 렉시컬환경으로 관리되고 코드의 실행순서는 실행컨텍스트 스택에 의해서 관리된다.



실행컨텍스트는 자바스크립트 코드의 동작을 이해하는데 있어 숲을 보게 해주는 개념이며 해당 개념에 대해서 제대로 이해한다면 클로저, this, 호이스팅, 스코프, 렉시컬환경 등에 대한 개념들도 쉽게 접근할 수 있습니다.

## 실행컨텍스트
함수가 실행되는 영역입니다. 함수코드를 실행하고 그 결과를 저장하는 영역입니다. 실행컨텍스트는 세가지 단계로 나눌 수 있습니다.
- 준비단계
- 초기화 단계
- 코드 실행 단계
  
실행컨텍스트가 생성되는 시점은 실행가능한 코드를 만났을때인데 함수코드와 글로벌 코드를 만났을때 생성됩니다. 실행 가능한 코드 유형이 분리된 이유는 실행컨텍스트에서 처리방법과 실행환경이 다르기떄문입니다.
- 함수코드 : 렉시컬환경 (정적환경)
- 글로벌코드 : 글로벌환경
  
실행컨텍스트 내부에는 세가지 프로퍼티를 갖는데 렉시컬환경, 변수환경, this 바인딩 을 갖고 각 프로퍼티는 객체로 내부에 또다른 프로퍼티를 갖습니다.

### 렉시컬 환경
함수와 변수의 식별자 해결을 위환 환경을 설정합니다. 함수초기화단계에서 해석한 함수와 변수를 `{key: value}` 형태로 저장하고 이름으로 함수와 변수를 검색할 수 있습니다.  
함수 밖의 함수와 변수를 참조하는 환경을 설정하기때문에 외부함수의 함수와 변수를 사용할 수 있습니다.
  
렉시컬환경에는 다시 환경레코드와 외부 렉시컬 환경참조 객체가 만들어 지는데 환경 레코드에는 함수내부의 함수와 변수를 기록합니다. 외부 렉시컬 환경 참조객체에서는 외부함수의 변수와 함수를 참조합니다. 
실행컨텍스트내에서 함수내부와 외부의 함수, 변수를 사용할 수 있기때문에 실행컨텍스트를 벗어나지않고 처리가 가능합니다.

### 변수 환경
실행컨텍스트 초기화 단계에서 렉시컬 환경과 동일하게 설정합니다. 초기값을 복원할때 사용합니다.  
무슨말이냐면 함수코드가 실행되면 실행결과를 렉시컬 환경 컴포넌트에 설정하게 되는데 그렇게되면 초기에 할당되었던 값과 다른 값을 갖게됩니다. 이때 다시 렉시컬 환경을 초기화 시켜주기위함입니다.

### 실행컨텍스트 실행 순서 정리
```js
function book() {
  function get() {
    return point;
  };
  var point = 123;
  return get();
}
console.log(book())
```
```js
// get
실행컨텍스트: {
  렉시컬환경: {
    환경레코드: {

    },
    외부 렉시컬 환경 참조: {
      point: 123
    }
  },
}

// book
실행컨텍스트: {
  렉시컬환경: {
    환경레코드: {
      point: 123,
      get: function
    },
    외부 렉시컬 환경 참조: {
      
    }
  },
}
```

### 환경레코드
```js
실행컨텍스트: {
  렉시컬 환경 : {
    환경레코드: {
      선언적 환경 레코드 : {},
      오브젝트 환경 레코드 : {}
    },
    외부 렉시컬 환경 참조: {}
  }
}
```

환경레코드를 구분하는 이유는 기록 대상이 다르기 때문입니다. 선언적환경 레코드는 function, 변수, catch 문에서 사용합니다.
  
오브젝트환경 레코드에는 글로벌 함수와 변수,  with 문에서 사용합니다.

### 외부 렉시컬 환경
외부 렉시컬 환경에 대한 참조는 상위스코프를 가르킵니다. 외부 렉시컬 환경에 대한 참조를 통해 단방향 링크드 리스트인 스코프 체인을 구현합니다.

## this 바인딩
this로 함수를 호출한 오브젝트의 프로퍼티에 접근

## 호출스택
> 자바스크립트는 싱글스레드로 동작합니다.
호출스택은 함수의 실행순서를 관리하며 스택이라는 자료구조의 형태를 갖고있습니다. First In Last Out 순서로 함수가 실행되고 소멸됩니다. 함수가 호출되면 가장 마지막에 호출됬던 함수의 실행컨텍스트가 위치하게되고 실행후 가장 마지막 즉 맨위에있던 함수가 가장 먼저 스택에서 제거됩니다.
  
가장 맨 밑에는 전역실행컨텍스트가 위치하게됩니다.
```js
// 크롬 개발자 도구에서 sources 탭에서 call stack 에서 확인가능
function one() {
  two();
  console.log(1);
}

function two() {
  three();
  console.log(2);
}

function three() {
  console.log(3)
}

one()
```

## 함수호출
함수가 호출되면 3개의 파라미터 값을 실행컨텍스트에 넘겨줍니다.
- 함수를 호출한 오브젝트 (this 로 참조 가능)
- 함수코드
- 호출한 함수의 파라미터 값 (Argument 오브젝트에 설정)



