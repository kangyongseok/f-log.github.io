---
title: "개발자가 일 더 잘하는 법"
categories: 
  -  conference
tags: 
    - develop
    - study
    - wanted
    - 개발자가 일하는법
    - 대량트래픽
    - 당근마켓
    - 우아한형제들
toc: true
toc_sticky: true
comments:  true
---

## 배달의 민족 - 생존을위한 마이크로 서비스

### 배달의민족 서비스 특징
1. 특정시간에 몰리는 트래픽
2. 급격한 성장과 빠른 가입자수
3. 가입자수와 함꼐 늘어가는 입점업체
4. 늘어나는 사용자와 점주들을 관리하기위한 데이터들(포인트, 쿠폰, 광고, 댓글, 평점....)
5. 배달주문에서 가장 필요한건 신속
6. 장애발생으로 주문이 딜레이되거나 주문이 잡히지않거나 했을때 가게점주들에겐 매출에 심각한 타격 사용자들에겐 서비스에 대한 좋지않은경험
 

### 2015년
하나의 데이터베이스로 배달에 필요한 모든 기능을 관리하고 있었음  (단일서비스)
- 프론트서버,
- 회원/인증,
- 리뷰,
- 쿠폰,
- 정산,
- 포인트,
- 주문,
- 결제,
- 광고,
- 메뉴,
- 가게/업주,

이렇게 진행되었을때 가장 큰 문제점은 데이터베이스에 장애가 발생했을경우 모든 서비스가 다 중단되어 버리는 상황이 발생

### 2016년
마이크로서비스 시작 PHP => JAVA  
- 매년 트래픽이 두배 세배씩 증가
- 더이상 현재구조로는 늘어나는 데이터를 감당하기 불가능
- 그나마 구조상 가장 뒤쪽에 위치해있고 의존성관계가 낮았던 결제와 주문중계 로직을 독립
- IDC => AWS 로 이전 시작
- 원래 한달의 기간을 두고 진행하려고 했지만 그당시 진행하던 선착순 이벤트로 급격한 트래픽 증가로 결제에서 서비스가 죽어버려서 하루만에 이전작업을 진행
- 주문중계는 단순히 전달만을 담당하고 있기때문에 Node.js 로 개발하여 분리

### 2017년
- 하루주문수 20만 돌파
- 대장애의 시대
- 메뉴, 정산, 가게목록 시스템 독립
- 배달앱 특성상 점심 그리고 저녁시간대에 주로 트래픽이 몰리는데 이때 주문에 에러가 발생하게되면 가게점주뿐만 아니라 배달을 요청한 사용자에게도 안좋은 경험을 안겨주게된다.
- 때문에 생존을 위해서라도 장애 대응을 위해서라도 마이크로서비스를 실행하는건 사용자들에게도 개발자들에게도 매우 중요한 일이었음

### 2018년
- 대대적으로 사업의 확장보다는 현재 장애에 대한 대응과 앞으로의 대비를 할 시간을 갖고 재정비를 하는게 좋겠다는 의사결정이 나옴
- 루비에서 벗어난 개발
- 오프라인모드 적용으로 서버에 장애가 발생하더라도 전화주문으로 돌려 받을 수 있게끔함
- 신규 가게 상세는 PHP 에서 JAVA언어로 변경하여 개발 하였고 AWS의 다이나모디비를 중간에 두어 루비DB에 대한 부하를 줄임

**레거시 3대장**
1. 주문
2. 가게/업주
3. 광고

**주문 이벤트 기반 아키텍쳐 구성**  
![아키텍쳐](https://i.ibb.co/pQhJZZc/2020-10-31-6-23-31.png)

### 아키텍쳐의 고려사항
- 성능
- 장애격리
- 데이터 동기화

API호출 형식으로 구성할 수 있었으나 이렇게 했을경우 발생하는 문제가 광고와 가게 업주 두 API가 죽어버린다면 연관된 요청하고있는 서비스들이 연쇄적으로 중단되어버림  
따라서 대용량 트래픽을 감당할 성능이 필요하고 장애가 발생해도 고객서비스를 유지하고 주문까지 가능해야한다.  

### CQRS 도입
**CQRS는 Command and Query Responsibility Segregation(명령과 조회의 책임 분리)**  
라고 하며 시스템에서 명령을 처리하는 책임과 조회를 처리하는 책임을 분리하는것이 핵심  

- 조회 - 고성능 데이터 저장소가 필요
  - 가게노출 : DynamoDB, MongoDB(NoSQL), Redis
  - 광고리스팅, 검색 : Elasticsearch
  - 바로결제라이브 : Redis
- 명령 - 안정성이 높은 데이터 저장소가 필요
  - 광고 : 오로라DB(RDB)
  - 가게/업주 : 오로라DB(RDB)

### 장애가 격리됨
- 각 시스템이 내부에 필요한 데이터 보관
- 내부 서비스의 모든 변경 내역이 이벤트로 전달
- 장애시 데이터싱크가 늦어져도 고객 서비스 가능




## 당근마켓 - 성장 단계별 개발이야기
개발초기에 Ruby on Rails 를 사용하여 개발  
창업에 참여한 개발자중 두명이  Ruby on Rails 에 익숙한 개발자  
그리고 새로운 기능을 적용할때 빠르게 붙여서 사용이 가능하다.  
  
빠른 적용과 변화에 적절한 프레임 워크  
  
채용에 문제가 있었지만 어차피 대부분의 서비스는 커지기전에 망한다 생각하기때문에 나중에 서비스가 커지고
성장하게되면 그때 생각해보자 라는 생각으로 시작
  
AWS EC2 를 사용하여 서비스를 배포
  
Docker 라는 도구가 있지만 초기단계에서는 서비스변화에 빠르게 대응해야하기때문에 전통적인 시스템이 더 나았고
도커를 사용하려면 이미지 빌드 배포 관리등 신경써야할 부분이 많음 즉 서비스를 뭔가 시행해보기도전에
서비스를 관리하는데 있어 압박감에 압사당할 수 있음

> Eric Ries - 린스타트업 저자  
> 스타트업은 극심한 불확실성의 상황 하에서 새로운 제품이나 서비스를 만들어내기위해 디자인된 인간 조직이다.

## 라쿠텐 - E2E 테스트 자동화

## Planetarium - 개발 문화 구축 방법

## Grab - 3천명의 개발자가 협업하는 과정 그리고 성장
